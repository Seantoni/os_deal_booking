generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model BookingRequest {
  id                     String                  @id
  name                   String
  category               String?
  parentCategory         String?
  subCategory1           String?
  subCategory2           String?
  subCategory3           String?
  merchant               String?
  businessEmail          String
  startDate              DateTime
  endDate                DateTime
  status                 String                  @default("draft")
  userId                 String
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  eventId                String?
  processedAt            DateTime?
  processedBy            String?
  rejectionReason        String?
  accountNumber          String?
  accountType            String?
  additionalComments     String?
  addressAndHours        String?
  bank                   String?
  bankAccountName        String?
  blackoutDates          String?
  businessReview         String?
  campaignDuration       String?
  cancellationPolicy     String?
  commission             String?
  contactDetails         String?
  corregimiento          String?
  district               String?
  exclusivityCondition   String?
  giftVouchers           String?
  hasExclusivity         String?
  hasOtherBranches       String?
  includesTaxes          String?
  isRecurring            String?
  legalName              String?
  marketValidation       String?
  paymentInstructions    String?
  paymentType            String?
  pricingOptions         Json?
  province               String?
  recurringOfferLink     String?
  redemptionContactEmail String?
  redemptionContactName  String?
  redemptionContactPhone String?
  redemptionMethods      Json?
  redemptionMode         String?
  rucDv                  String?
  socialMedia            String?
  validOnHolidays        String?
  vouchersPerPerson      String?
  opportunityId          String?
  dealId                 String?                 @unique
  publicLinkToken        String?                 @unique
  sourceType             String                  @default("internal")
  fieldComments          Json?
  additionalEmails       Json?
  additionalInfo         Json?
  subCategory4           String?
  dealImages             Json?
  aboutCompany           String?
  aboutOffer             String?
  goodToKnow             String?
  whatWeLike             String?
  shortTitle             String?
  offerMargin            String?
  public_request_links   public_request_links?   @relation(fields: [publicLinkToken], references: [token])
  deals                  deals?
  external_api_requests  external_api_requests[]
  marketing_campaigns    marketing_campaigns?

  @@index([businessEmail])
  @@index([dealId])
  @@index([eventId])
  @@index([opportunityId])
  @@index([parentCategory])
  @@index([publicLinkToken])
  @@index([sourceType])
  @@index([status])
  @@index([userId])
}

model Event {
  id               String   @id
  name             String
  description      String?
  startDate        DateTime
  endDate          DateTime
  userId           String
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  category         String?
  merchant         String?
  parentCategory   String?
  subCategory1     String?
  subCategory2     String?
  subCategory3     String?
  bookingRequestId String?
  status           String   @default("approved")
  subCategory4     String?

  @@index([bookingRequestId])
  @@index([category])
  @@index([merchant])
  @@index([parentCategory])
  @@index([status])
  @@index([subCategory1])
  @@index([subCategory2])
  @@index([subCategory3])
  @@index([subCategory4])
  @@index([userId])
}

model UserProfile {
  id                  String                @id
  clerkId             String                @unique
  email               String?
  name                String?
  role                String                @default("sales")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  isActive            Boolean               @default(true)
  business_sales_reps business_sales_reps[]

  @@index([clerkId])
  @@index([email])
  @@index([isActive])
  @@index([role])
}

model access_audit_logs {
  id             String          @id
  email          String
  action         String
  performedBy    String
  performedAt    DateTime        @default(now())
  notes          String?
  allowedEmailId String?
  allowed_emails allowed_emails? @relation(fields: [allowedEmailId], references: [id])

  @@index([action])
  @@index([email])
  @@index([performedAt])
}

model activity_logs {
  id         String   @id
  userId     String
  userName   String?
  userEmail  String?
  action     String
  entityType String
  entityId   String?
  entityName String?
  details    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([action])
  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([userId])
}

model allowed_emails {
  id                String              @id
  email             String              @unique
  isActive          Boolean             @default(true)
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  createdBy         String
  clerkInvitationId String?
  invitationStatus  String?
  invitedAt         DateTime?
  invitedBy         String?
  invitedRole       String?
  firstName         String?
  lastName          String?
  access_audit_logs access_audit_logs[]

  @@index([email])
  @@index([invitationStatus])
  @@index([isActive])
}

model business_sales_reps {
  id          String      @id
  businessId  String
  salesRepId  String
  createdAt   DateTime    @default(now())
  businesses  businesses  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  UserProfile UserProfile @relation(fields: [salesRepId], references: [clerkId], onDelete: Cascade)

  @@unique([businessId, salesRepId])
  @@index([businessId])
  @@index([salesRepId])
}

model businesses {
  id                   String                @id
  name                 String
  contactName          String
  contactPhone         String
  contactEmail         String
  categoryId           String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  description          String?
  instagram            String?
  ownerId              String?
  salesTeam            String?
  tier                 Int?
  website              String?
  leadId               String?               @unique
  sourceType           String                @default("manual")
  metrics              Json?
  accountManager       String?
  accountNumber        String?
  accountType          String?
  address              String?
  bank                 String?
  beneficiaryName      String?
  corregimiento        String?
  district             String?
  emailPaymentContacts String?
  ere                  String?
  isAsesor             String?
  neighborhood         String?
  osAsesor             String?
  paymentPlan          String?
  province             String?
  razonSocial          String?
  ruc                  String?
  salesType            String?
  osAdminVendorId      String?
  focusPeriod          String?
  focusSetAt           DateTime?
  business_sales_reps  business_sales_reps[]
  categories           categories?           @relation(fields: [categoryId], references: [id])
  leads                leads?
  opportunities        opportunities[]

  @@index([categoryId])
  @@index([leadId])
  @@index([name])
  @@index([ownerId])
}

model categories {
  id             String       @id
  parentCategory String
  subCategory1   String?
  subCategory2   String?
  subCategory3   String?
  categoryKey    String       @unique
  maxDuration    Int          @default(5)
  isActive       Boolean      @default(true)
  displayOrder   Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  subCategory4   String?
  businesses     businesses[]
  leads          leads[]

  @@index([categoryKey])
  @@index([displayOrder])
  @@index([isActive])
  @@index([parentCategory])
}

model competitor_deal_snapshots {
  id               String           @id
  dealId           String
  totalSold        Int
  offerPrice       Decimal          @db.Decimal(10, 2)
  originalPrice    Decimal          @db.Decimal(10, 2)
  scannedAt        DateTime         @default(now())
  competitor_deals competitor_deals @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([dealId])
  @@index([scannedAt])
}

model competitor_deals {
  id                        String                      @id
  sourceUrl                 String                      @unique
  sourceSite                String
  merchantName              String
  dealTitle                 String
  originalPrice             Decimal                     @db.Decimal(10, 2)
  offerPrice                Decimal                     @db.Decimal(10, 2)
  discountPercent           Int
  totalSold                 Int                         @default(0)
  imageUrl                  String?
  status                    String                      @default("active")
  isTracking                Boolean                     @default(true)
  firstSeenAt               DateTime                    @default(now())
  lastScannedAt             DateTime                    @default(now())
  expiresAt                 DateTime?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  tag                       String?
  competitor_deal_snapshots competitor_deal_snapshots[]

  @@index([firstSeenAt])
  @@index([isTracking])
  @@index([lastScannedAt])
  @@index([merchantName])
  @@index([sourceSite])
  @@index([status])
}

model custom_field_values {
  id            String        @id
  customFieldId String
  entityId      String
  entityType    String
  value         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  custom_fields custom_fields @relation(fields: [customFieldId], references: [id], onDelete: Cascade)

  @@unique([customFieldId, entityId])
  @@index([customFieldId])
  @@index([entityId])
  @@index([entityType])
}

model custom_fields {
  id                  String                @id
  fieldKey            String                @unique
  label               String
  fieldType           String
  entityType          String
  isRequired          Boolean               @default(false)
  placeholder         String?
  defaultValue        String?
  helpText            String?
  options             Json?
  displayOrder        Int                   @default(0)
  showInTable         Boolean               @default(false)
  isActive            Boolean               @default(true)
  createdBy           String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  custom_field_values custom_field_values[]

  @@index([displayOrder])
  @@index([entityType])
  @@index([fieldKey])
  @@index([isActive])
}

model deals {
  id               String         @id
  bookingRequestId String         @unique
  responsibleId    String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  status           String         @default("pendiente_por_asignar")
  opportunityId    String?        @unique
  ereResponsibleId String?
  BookingRequest   BookingRequest @relation(fields: [bookingRequestId], references: [id], onDelete: Cascade)
  opportunities    opportunities? @relation(fields: [opportunityId], references: [id])

  @@index([bookingRequestId])
  @@index([ereResponsibleId])
  @@index([opportunityId])
  @@index([responsibleId])
  @@index([status])
}

model external_api_requests {
  id               String          @id
  endpoint         String
  method           String          @default("POST")
  requestBody      Json?
  headers          Json?
  statusCode       Int?
  responseBody     Json?
  responseRaw      String?
  success          Boolean         @default(false)
  errorMessage     String?
  externalId       Int?
  bookingRequestId String?
  userId           String?
  triggeredBy      String?
  durationMs       Int?
  createdAt        DateTime        @default(now())
  BookingRequest   BookingRequest? @relation(fields: [bookingRequestId], references: [id])

  @@index([bookingRequestId])
  @@index([createdAt])
  @@index([endpoint])
  @@index([statusCode])
  @@index([success])
  @@index([userId])
}

model form_field_configs {
  id                   String        @id
  entityType           String
  sectionId            String
  fieldKey             String
  fieldSource          String        @default("builtin")
  displayOrder         Int           @default(0)
  isVisible            Boolean       @default(true)
  isRequired           Boolean       @default(false)
  isReadonly           Boolean       @default(false)
  width                String        @default("full")
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  canEditAfterCreation Boolean       @default(false)
  form_sections        form_sections @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@unique([entityType, fieldKey])
  @@index([displayOrder])
  @@index([entityType])
  @@index([fieldKey])
  @@index([sectionId])
}

model form_sections {
  id                 String               @id
  entityType         String
  name               String
  displayOrder       Int                  @default(0)
  isCollapsed        Boolean              @default(false)
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  form_field_configs form_field_configs[]

  @@index([displayOrder])
  @@index([entityType])
  @@index([isActive])
}

model leads {
  id            String      @id
  name          String
  contactName   String
  contactPhone  String
  contactEmail  String
  categoryId    String?
  responsibleId String?
  stage         String      @default("por_asignar")
  website       String?
  instagram     String?
  description   String?
  source        String?
  notes         String?
  businessId    String?     @unique
  convertedAt   DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime
  businesses    businesses? @relation(fields: [businessId], references: [id])
  categories    categories? @relation(fields: [categoryId], references: [id])

  @@index([businessId])
  @@index([categoryId])
  @@index([name])
  @@index([responsibleId])
  @@index([stage])
}

model marketing_campaigns {
  id                String              @id
  bookingRequestId  String              @unique
  doMarketing       Boolean             @default(true)
  skipReason        String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  createdBy         String?
  generatedCopy     String?
  videoScript       String?
  BookingRequest    BookingRequest      @relation(fields: [bookingRequestId], references: [id], onDelete: Cascade)
  marketing_options marketing_options[]

  @@index([bookingRequestId])
  @@index([doMarketing])
}

model marketing_option_comments {
  id                String            @id
  optionId          String
  userId            String
  content           String
  mentions          Json?
  reactions         Json?
  attachments       Json?
  isEdited          Boolean           @default(false)
  editedAt          DateTime?
  isDeleted         Boolean           @default(false)
  deletedAt         DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  readBy            Json?
  dismissedBy       Json?
  marketing_options marketing_options @relation(fields: [optionId], references: [id], onDelete: Cascade)

  @@index([optionId, createdAt])
  @@index([userId])
}

model marketing_options {
  id                        String                      @id
  campaignId                String
  platform                  String
  optionType                String
  isPlanned                 Boolean                     @default(false)
  isCompleted               Boolean                     @default(false)
  dueDate                   DateTime?
  completedAt               DateTime?
  completedBy               String?
  notes                     String?
  mediaUrls                 Json?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  notesUpdatedAt            DateTime?
  notesUpdatedBy            String?
  responsibleId             String?
  marketing_option_comments marketing_option_comments[]
  marketing_campaigns       marketing_campaigns         @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, platform, optionType])
  @@index([campaignId])
  @@index([isCompleted])
  @@index([isPlanned])
  @@index([platform])
  @@index([responsibleId])
}

model opportunities {
  id                   String                 @id
  businessId           String
  stage                String                 @default("iniciacion")
  startDate            DateTime
  closeDate            DateTime?
  notes                String?
  userId               String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  lastActivityDate     DateTime?
  nextActivityDate     DateTime?
  responsibleId        String?
  hasRequest           Boolean                @default(false)
  bookingRequestId     String?
  dealId               String?                @unique
  lostReason           String?
  name                 String?
  deals                deals?
  businesses           businesses             @relation(fields: [businessId], references: [id], onDelete: Cascade)
  opportunity_comments opportunity_comments[]
  tasks                tasks[]

  @@index([bookingRequestId])
  @@index([businessId])
  @@index([dealId])
  @@index([responsibleId])
  @@index([stage])
  @@index([userId])
}

model opportunity_comments {
  id            String        @id
  opportunityId String
  userId        String
  content       String
  mentions      Json?
  reactions     Json?
  isEdited      Boolean       @default(false)
  editedAt      DateTime?
  isDeleted     Boolean       @default(false)
  deletedAt     DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  readBy        Json?
  dismissedBy   Json?
  opportunities opportunities @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@index([opportunityId, createdAt])
  @@index([userId])
}

model public_request_links {
  id             String          @id
  token          String          @unique
  createdBy      String
  recipientEmail String
  isUsed         Boolean         @default(false)
  usedAt         DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  BookingRequest BookingRequest?

  @@index([createdBy])
  @@index([isUsed])
  @@index([recipientEmail])
  @@index([token])
}

model saved_filters {
  id         String   @id
  name       String
  entityType String
  filters    Json
  createdBy  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([createdBy])
  @@index([entityType])
}

model settings {
  id                         String   @id @default("default")
  minDailyLaunches           Int      @default(5)
  maxDailyLaunches           Int      @default(13)
  merchantRepeatDays         Int      @default(30)
  categoryDurations          Json
  businessExceptions         Json
  customCategories           Json
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime
  updatedBy                  String?
  additionalInfoMappings     Json?
  requestFormFields          Json?
  hiddenCategoryPaths        Json?
  externalApiSectionMappings Json?
}

model tasks {
  id            String        @id
  opportunityId String
  category      String
  title         String
  date          DateTime
  completed     Boolean       @default(false)
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  opportunities opportunities @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([date])
  @@index([opportunityId])
}
