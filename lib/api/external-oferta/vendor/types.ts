/**
 * Types for External Oferta Vendor API
 * Based on OpenAPI schema: POST /external/api/vendors
 */

/**
 * Sales type enum for vendor classification
 * Maps to external API salesType integer
 */
export const VENDOR_SALES_TYPE = {
  REGULAR: 0,
  INSIDE: 1,
  RECURRING: 2,
  OSP: 3,
} as const

export type VendorSalesType = typeof VENDOR_SALES_TYPE[keyof typeof VENDOR_SALES_TYPE]

/**
 * Request payload for creating a vendor in the external Oferta API
 */
export interface ExternalOfertaVendorRequest {
  // ===== REQUIRED FIELDS =====
  /** Vendor/business name */
  name: string
  /** Vendor email (must be unique in external system) */
  email: string
  /** Sales type: 0=Regular, 1=Inside, 2=Recurring, 3=OSP */
  salesType: number

  // ===== OPTIONAL - Direct mappings from Business =====
  /** Vendor address */
  address?: string | null
  /** Phone number */
  phoneNumber?: string | null
  /** Website URL */
  website?: string | null
  /** Manager/contact name */
  managerName?: string | null
  /** Contact email (can differ from main email) */
  emailContact?: string | null
  /** Business legal name (razón social) */
  razonSocial?: string | null
  /** Tax ID (RUC) */
  ruc?: string | null
  /** Bank account beneficiary name */
  beneficiaryName?: string | null
  /** Bank account number */
  account?: string | null
  /** Account type (Cuenta Corriente, Cuenta de Ahorros, etc.) */
  accountType?: string | null
  /** Payment plan (QR - Daily, QR - Weekly, etc.) */
  paymentPlan?: string | null

  // ===== OPTIONAL - Need future mapping (TODO) =====
  /** Bank ID - TODO: Map from bank name string */
  bankId?: number | null
  /** Neighborhood ID - TODO: Map from neighborhood string */
  neighborhoodId?: number | null
  /** OS Sales team member ID - TODO: Map from UserProfile */
  osSalesId?: number | null
  /** OS Account manager ID - TODO: Map from accountManager */
  osAccountId?: number | null
  /** OS Merchant ID - TODO: Add to model */
  osMerchantId?: number | null
  /** OS Inside Sales ID - TODO: Add to model */
  osInsideSalesId?: number | null

  // ===== OPTIONAL - Skipped (not in our model) =====
  /** Vendor portal password (auto-generated by external system) */
  password?: string | null
  /** Website display title */
  websiteTitle?: string | null
  /** Latitude for vendor location */
  lat?: string | null
  /** Longitude for vendor location */
  lng?: string | null
  /** Map search string */
  mapSearchString?: string | null
  /** Map URL */
  mapUrl?: string | null
  /** Parent company vendor ID */
  parentCompanyId?: number | null
  /** Whether comment notifications are enabled */
  commentNotificationEnabled?: boolean | null
  /** Whether refunds are disabled */
  noRefund?: boolean | null
  /** Whether to merge sub-vendors */
  mergeVendors?: boolean | null
  /** Whether credentials have been sent */
  credentialsSent?: boolean | null
  /** Flagged reason: 0=None, 1=Reasignar, 2=Sacar, 3=Otro */
  flaggedReason?: number | null
  /** Flagged comment */
  flaggedComment?: string | null
  /** Logo filename or URL */
  logo?: string | null
  /** PDF filename */
  pdf?: string | null
}

/**
 * Response from vendor creation API
 */
export interface ExternalOfertaVendorResponse {
  /** Created vendor ID in external system */
  id: number
  /** Status message (e.g., "success") */
  status: string
}

/**
 * Result of vendor creation attempt
 */
export interface SendVendorResult {
  success: boolean
  /** External vendor ID (if successful) */
  externalVendorId?: number
  /** Error message (if failed) */
  error?: string
  /** Log ID for tracking */
  logId?: string
}

// ============================================
// PATCH /external/api/vendors/{id} - Update
// ============================================

/**
 * Request payload for updating a vendor (PATCH)
 * All fields are optional - only send changed fields
 */
export type ExternalOfertaVendorUpdateRequest = Partial<Omit<ExternalOfertaVendorRequest, 'salesType'>> & {
  /** Sales type is optional on update */
  salesType?: number
}

/**
 * Result of vendor update attempt
 */
export interface UpdateVendorResult {
  success: boolean
  /** External vendor ID */
  externalVendorId?: number
  /** Number of fields updated */
  fieldsUpdated?: number
  /** Error message (if failed) */
  error?: string
  /** Log ID for tracking */
  logId?: string
}

/**
 * Describes a single field change for display in confirmation dialog
 */
export interface VendorFieldChange {
  /** Internal field key (e.g., "contactPhone") */
  fieldKey: string
  /** API field key (e.g., "phoneNumber") */
  apiKey: string
  /** Spanish label for display (e.g., "Teléfono") */
  label: string
  /** Previous value (null if was empty) */
  oldValue: string | null
  /** New value */
  newValue: string | null
  /** Whether this is a new value (was empty before) */
  isNew: boolean
}
